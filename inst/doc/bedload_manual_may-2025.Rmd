---
title: "Bedload Manual"
output: rmarkdown::html_vignette
vignette: > 
  %\VignetteIndexEntry{Bedload Manual}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
#source(here('bedload', 'R','bedload_functions.R'))
library(bedload)
```

# Background

The bedload package was created to automate the performance of various
analyses that come up in applied geoscience. The philosophy of the
package is to construct flexible tools that can be easily incorporated
into data analysis workflows without a detailed background in R
programming. It relies on other packages for importing and analyzing
various types of environmental data that are used when analyzing
questions related to bed material transport.

# Analysis Functions

The analysis functions in this section are designed to perform a range
of commonly executed analyses. They are built with various functions
from the subsequent sections. The typical workflows are presented with
each analysis function.

New analysis functions will continue to be added to the `bedload`
package as new use cases are developed.

------------------------------------------------------------------------

## compare_fun

This function compares the transport functions for a specified grain
size and channel gradient over a reasonable range of shear stress values
using the default values for all functions.

### Usage {.unnumbered}

`compare_fun(d, S, d84 = 2 * d, g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `d` median bed sediment grain diameter (m)

-   `S` gradient of the water surface slope (m/m)

-   `d84` 84th percentile diameter of bed sediment (m). Defaults to
    `2 * d`

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function is intended to visualize how the various transport
functions compare with one another for a given grain size and energy
gradient. The results depend in large part on the relative roughness of
the stream be analysed, which is implicit in the choice of grain size
and gradient.

### Output {.unnumbered}

The function simply produces a graph of the calculated volumetric
bedload transport rate per unit width for a specified range of
dimensionless shear stress values.

### Examples {.unnumbered}

Here is an example for a steep stream with high relative roughness.

```{r}
compare_fun(d = 0.05, 
            S = 0.02)
```

And here is an example for a stream with much lower gradient and lower
relative roughness.

```{r}
compare_fun(d = 0.05, 
            S = 0.0002)
```

### See also {.unnumbered}

`mpm()`, `wp()`, `eb()`, `yln()`, `vr()`, `ec()`, `rk()`

------------------------------------------------------------------------

## estimate_hydraulics

this function estimates hydraulic properties at regular WSE elevation
intervals, effectively building a rating curve and mapping out the
at-a-station hydraulic geometry for the cross section being analyzed.
These data can be used to interpolate values for target flow values. The
calculations include estimates of the bedload flux calculated using one
of several bedload transport equations.

### Usage {.unnumbered}

`estimate_hydraulics(xs_data, S, d, d84 = 2 * d, ymax = 1.5, ...`
`dx = 0.05, t_crit = t_crit_soul(d), g = 9.81, rho = 1000, ...`
`rho_s = 2650, a1 = 6.5, a2 = 2.5, kv = 1e-06, fun = "ec", rp = FALSE)`

### Arguments {.unnumbered}

-   `xs_data` a data frame containing variables `dist` (distances) and
    `z` (elevations)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `d84` 84th percentile diameter of bed sediment (m). Defaults to 2 \*
    d

-   `ymax` the maximum flow depth to model, measured at the thalweg,
    defaults to 3.5 m

-   `dx` the increment by which to change stage. defaults to 0.05 m

-   `t_crit` critical dimensionless shear stress, calculated using the
    Soulsby (1997) equation

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `a1` constant fit by Ferguson (2007). Defaults to 6.5

-   `a2` constant fit by Ferguson (2007). Defaults to 2.5

-   `kv` kinematic viscosity of water. Defaults to 1e-6

-   `fun` choice of bedload function: 'eb','ec', 'rk', 'mpm', 'vr','wp',
    'yln'. Defaults to 'ec'

-   `rp` option for 'rk' select equation suited to riffle pool
    morphology, default is FALSE

### Details {.unnumbered}

This function uses the Ferguson (2007) flow resistance equation to
calculate the velocity for a sequence of water depths at a given cross
section. It builds a dataset of hydraulic geometry values (mean depth,
water surface width, wetted perimeter), and cross section-average
hydraulic parameters (velocity, shear stress, bedload transport
capacity) for a range of discharges.

### Output {.unnumbered}

The function produces a data frame containing estimates of the mean area
of flow (area),flow width (width), wetted parameter (perimeter), mean
flow velocity (velocity), bed load transport capacity (transport), water
surface elevation (wse), and dimensionless shear stress (t_star) for a
range of discharge values (flow).

### Examples {.unnumbered}

To use `estimate_hydraulics()` it is necessary to have at a minimum a
topographic cross section, an estimate of the reach-average gradient,
and an estimate of the mean surface grain size.

```{r}

example_section <- make_trapezoid(w_top = 10,
                                  w_bot = 5,
                                  H_bank = 1.5,
                                  Z_fp = 100)
plot(example_section$dist, example_section$Z,
     col = "darkgreen", 
     xlab = "distance (m)",
     ylab = "elevation (m)",
     asp = 1)
example_slope <- 0.05
example_d <- 0.04
example_result <- estimate_hydraulics(xs_data = example_section,
                                      S = example_slope,
                                      d = example_d)
head(example_result)

```

### See also {.unnumbered}

`load_section()`, `make_trapezoid()`,

------------------------------------------------------------------------

## estimate_capacity

this function uses a data frame created by the `estimate_hydraulics()`
utility function to approximate the volume of bed material that could be
transported during a hydrograph. It also estimates the geomorphically
active volume of transport based on a threshold dimensionless shear
stress.

### Usage {.unnumbered}

`estimate_capacity(xs_hyd, Q, t, tc = 0.08, mkplt = FALSE)`

### Arguments {.unnumbered}

-   `xs_hyd` a data frame created by `estimate_hydraulics()`

-   `Q` a vector containing the flows that define the hydrograph

-   `t` a vector that contains the corresponding times for each Q value
    (hours)

-   `tc` the threshold dimensionless shear stress for channel change

-   `mkplt` option to make a plot of the data, defaults to FALSE

### Details {.unnumbered}

This function first requires the user to create: a data frame using the
`estimate_hydraulics()` function; and two vectors that define an event
hydrograph over which to integrate the sediment transport capacity.

### Output {.unnumbered}

The function outputs a data frame with the following information:

-   `Qmax` peak flow of the hydrograph (cubic meters per sec)
-   `vol_transp` volume of bedload transported during hydrograph (cubic
    meters)
-   `vol_active` volume of bedload transported when shear stresses
    exceeded a user-specified threshold dimensionless shear stress for
    channel change (cubic meters)
-   `width` maximum width of the channel during the flood (m)
-   `vel` maximum cross sectional average flow velocity (m/s)
-   `area` maximum cross sectional area for flow (m$^2$/s)
-   `wse` maximum water surface elevation during the peak flow (m)

### Examples {.unnumbered}

The code below provides an example of a typical work flow involved in
making the calculation.

```{r}
# enter data that you have from the field on the site of interest
test_d <- 0.05  # median surface texture, ideally from a Wolman sample
test_d84 <- 0.12  #the 84th percentile of the bed surface
test_slope <- 0.015  # reach average bed slope from lidar or map
top_width <- 12  # bank to bank width at the site
bot_width <- 3.5  # width of the channel bed 
bank_ht <- 1.2  # vertical high of the floodplain above the channel bed

# make a cross section for analysis based on field measurements
#(you can also is load_section() to load a more detailt topo profile)
test_section <- make_trapezoid(w_top = top_width,
                               w_bot = bot_width,
                               H_bank = bank_ht,
                               Z_fp = 100)

# use the scs_hydrograph() function to produce a hydrograph
test_Q_peak <- 12 # in cubic meters per second
test_time_lag <- 6 #in hours
test_dt <- 15/60 #produce discharge output every 15 minutes
test_hydrograph <- scs_hydrograph(Qpeak = test_Q_peak,
                                  tpeak = test_time_lag, 
                                  dt = test_dt)
plot(test_hydrograph)

# now we are ready to run estimate_hydraulics...
test_df <- estimate_hydraulics(xs_data = test_section,
                               S = test_slope,
                               d = test_d,
                               d84 = test_d84,
                               ymax = bank_ht * 2,
                               fun = "mpm"
                               )
# NOTE: the optional parameter ymax was assigned a value twice the channel depth...this is not strictly necessary, but ymax controls the range of water depths (and discharge values) analysed by the function, and the next step requires a data frame with discharge values at least as high as the peak flow being assessed.

# now we can run the integration over the hydrograph
test_output <- estimate_capacity(xs_hyd = test_df, 
                                 Q = test_hydrograph$y,
                                 t = test_hydrograph$x)

print(test_output)

# and we can show the peak water surface elevation on the cross section to check that things make sense

plot(test_section, asp = 2)
abline(h = test_output$wse, col = "blue", lty = 2)
```

### See also {.unnumbered}

`fractional_capacity()`, `bank_erode_fp`, `bank_erode_trc()`

------------------------------------------------------------------------

## fractional_capacity

Integrating the Wilcock and Crowe (2003) fractional bedload transport
function over a hydrograph

### Usage {.unnumbered}

`fractional_capacity(   hydrograph,   xs_data,   S,   gsd,   Fsand,   g = 9.81,   rho = 1000,   rho_s = 2650 )`

### Arguments {.unnumbered}

-   `hydrograph` a data frame created by `scs_hydrograph()` (Q in
    m$^3$/s and t in hours

-   `xs_data` a data frame containing topography expressed as dist
    (distances) and z (elevations)

-   `S` gradient of the water surface slope (m/m)

-   `gsd` a data frame describing the grain size distribution created
    with function `wolman_gsd()`

-   `Fsand` proportion of the surface that is covered by sand sized
    sediment (affects entrainment, typically varies from 0 to 0.2)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function integrates the Wilcock and Crowe transport function over a
hydrograph for a given cross section to estimate the total fractional
transport volumes for the flood event. Output includes the inputted GSD
information for each size class (Di, cpf, Dm, Fi), as well as the
volumetric transport rate (Qbi), and the fraction of the computed
bedload in each size class (Li)

### Output {.unnumbered}

The function outputs a data frame with the following information:

-   `Di` grain size (in mm) of the upper size of each size class
    analyzed
-   `cpf` cumulative proportion finer than each size `Di`
-   `dm` median size for each size class analyzed
-   `Fi` fraction of the bed surface in each size class
-   `Qbi` volume of sediment transported during the hydrograph for each
    size class
-   `Li` the fraction of the total transported volume in each size class

### Examples {.unnumbered}

The function is used in the following example to analyze the potential
rate and grain size distribution of bedload transport in a small gravel
bed stream during a flood, using the test data created to demonstrate
the `estimate_capacity` function. The `wolman_gsd()` function is used to
generate a data frame with the necessary grain size distribution
information in it to run the Wilcock and Crowe model. Alternatively, you
can use the `sim_gsd()` function to simulate a log-normal grain size
distribution.

```{r}
#example gsd data
field_sizes <- c(16, 23, 32, 45, 64, 91, 128, 181, 256, 360)
field_counts <-c(0, 4, 7, 15, 18, 20, 17, 11, 9, 5)

test_gsd <- wolman_gsd(Di = field_sizes, 
                  counts = field_counts)

#assume a percent sand for the bed surface
test_fsand <- 8 / 100  

test_output <- fractional_capacity(hydrograph = test_hydrograph,
                                    xs_data = test_section,
                                    S = test_slope,
                                    gsd = test_gsd,
                                    Fsand = test_fsand)

print(test_output)
```

The total volume of sediment transported during the flood can be
estimated by summing the values

```{r}
total_transport_volume <- sum(test_output$Qbi)
print(round(total_transport_volume))

```

The grain size distribution of the bed material and of the load can also
be compared.

```{r}
plot(test_output$dm, rev(cumsum(rev(test_output$Fi))),
     type = "b",
     lty = 2,
     pch = 20,
     log = "x",
     col = "darkgreen",
     ylim = c(0, 1),
     xlab = "Grain size (mm)",
     ylab = "Cumulative proportion finer")
points(test_output$dm, rev(cumsum(rev(test_output$Li))),
       pch = 20,
      col = "darkorange")
lines(test_output$dm, rev(cumsum(rev(test_output$Li))),
      lty = 2,
      col = "darkorange")
```

This analysis can also be performed if you only have an estimate of the
bed D50 and D84 by simulating a log-normal grain size distribution.

```{r}
#pick a D50 and log-normal standard deviation that gives the same D50 and D84 as the Wolman sample above
D50 <- approx(x = test_output$cpf,
              y = test_output$Di,
              xout = 0.5)[[2]]
sp <- 1.08 

test_gsd <- sim_gsd(D50, sp)

test_output <- fractional_capacity(hydrograph = test_hydrograph,
                                    xs_data = test_section,
                                    S = test_slope,
                                    gsd = test_gsd,
                                    Fsand = test_fsand)
total_transport_volume <- sum(test_output$Qbi)
print(round(total_transport_volume))

plot(test_output$dm, rev(cumsum(rev(test_output$Fi))),
     type = "b",
     lty = 2,
     pch = 20,
     log = "x",
     col = "darkgreen",
     ylim = c(0, 1),
     xlab = "Grain size (mm)",
     ylab = "Cumulative proportion finer")
points(test_output$dm, rev(cumsum(rev(test_output$Li))),
       pch = 20,
      col = "darkorange")
lines(test_output$dm, rev(cumsum(rev(test_output$Li))),
      lty = 2,
      col = "darkorange")
```

In this case the field-measured and the simulated grain size
distributions are quite similar, but larger differences can be expected
when the actual grain size distribution is not log-normally distributed.

### See also {.unnumbered}

`estimate_capacity()`, `bank_erode_fp`, `bank_erode_trc()`

------------------------------------------------------------------------

## gbem

the GBEM function: gravel-bed river bank erosion model. This function
estimates the change in channel width for a flood of magnitude `Q` and
duration `t` based on the sediment texture, slope, riparian vegetation
type, and the channel width at the beginning of the flood. It can also
be implemented at a finer timescale to predict the bank erosion during a
flood hydrograph.

### Usage {.unnumbered}

`gbem(   Q,   t,   n,   D84,   D50,   W,   S,   H = 0,   fun = "ec",   g = 9.81,   rho_s = 2650,   rho = 1000 )`

### Arguments {.unnumbered}

-   `Q` discharge carried by the stream (m$^3$/s)

-   `t` time for which Q acts on the stream channel (hrs)

-   `n` Manning's n value for the main channel

-   `D84` 84th percentile of the surface grain size distribution (m)

-   `D50` 50th percentile of the grain size distribution (m)

-   `W` water surface width at the beginning of time interval t

-   `S` energy gradient of the stream channel (m/m)

-   `H` effective rooting depth for vegetation; grassy banks, no trees /
    shrubs H = 0.35; 1 to 5 percent tree / shrub cover H = 0.50; 5 to 50
    percent tree / shrub cover H = 0.90; more than 50 percent tree /
    shrub cover H = 1.1

-   `fun` choice of transport function. Default is Eaton and Church
    ("ec")

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

This function implements the gravel bed bank erosion model (GBEM) that
is the core function used by STOCHASIM and the BGC stochastic bank
erosion model. It limits the amount of bank erosion that can occur in a
given timestep based on the bedload transport capacity of the stream
proximate to the channel banks. The output from this function is a
vector containing: (1) the predicted widening based only on a stability
criterion; (2) the predicted widening based on the stability criterion,
constrained by the bedload transport capacity; (4) the volume of bedload
that could be transported during the time step t in the near-bank
region; and (4) the critical depth for bank erosion

### Output {.unnumbered}

The function outputs a vector containing a string of four numbers

-   an estimate of the width increase based only on channel stability, constrained 
    by the ability of the river to transport bed material away from the banks
-   an estimate of the flow depth following bank erosion
-   an estimate of the total beload transport volume per unit width of
    the stream (m3/m)
-   an estimate of the critical depth for bank erosion to occur.

### Examples {.unnumbered}

Here is an example of a single calculation using GBEM.

```{r}
#specify flood details
flood_mag <- 40
flood_dur <- 6

#specify river reach details
river_n <- 0.04
river_d50 <- 0.04
river_d84 <- 2.1 * river_d50
river_w0 <- 25
river_slope <- 0.007
river_H <- 0.5

#run the model
out_put <- gbem(flood_mag, flood_dur, river_n, river_d84, river_d50, river_w0, river_slope, river_H)

#update the river width based on the modelled bank erosion
river_w1 <- river_w0 + out_put[2]
print(river_w1)
```

We can use the model to investigate the potential effects of a flood,
but also a disturbance such as a wildfire or riparian logging. The code
below simulates the effects on the stable channel width modeled above,
due to a loss of about half of the riparian bank strength. The modeled
bank strength loss is equivalent to transitioning from a cottonwood
forest to a grass field.

```{r}
#change the bank strength
river_H <- river_H / 2

#run the model using the stable width from the last model run
out_put <- gbem(flood_mag, flood_dur, river_n, river_d84, river_d50, river_w1, river_slope, H = river_H)
#update the river width based on the modelled bank erosion
river_w2 <- river_w1 + out_put[1]
print(river_w2)
```

Changes in bank strength have a very large potential effect on stable
channel dimensions, making floods that occur 5 to 10 years after an
intense wildfire in a riparian zone particularly hazardous.

### See also {.unnumbered}

`bank_erode_fp()`, `bank_erode_trc()`

------------------------------------------------------------------------

## bank_erode_fp

Estimate the cumulative bank erosion during a flood hydrograph for a
floodplain channel

### Usage {.unnumbered}

`bank_erode_fp(Q, t, n, D84, D50, W, S, H = 0, fun = "ec")`

### Arguments {.unnumbered}

-   `Q` a list of discharge values at regular time intervals defining
    the flood hydrograph (m$^3$/s)

-   `t` time interval between discharge measurements (hrs)

-   `n` Manning's n value for the main channel

-   `D84` 84th percentile of the surface grain size distribution (m)

-   `D50` 50th percentile of the grain size distribution (m)

-   `W` water surface width at the beginning of time interval t

-   `S` energy gradient of the stream channel (m/m)

-   `H` effective rooting depth for vegetation

-   `fun` choice of transport function. Default is Eaton and Church
    ("ec")

-   `Z` height of the terrace above the channel bottom (m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function implements the GBEM model for estimating bank erosion
using the standard model for streams where the floodplain is assumed to
be equal to the critical depth based on the bed texture and slope. The
function outputs a data frame containing variables for time since the
start of the hydrograph (time), discharge values for each time (Q), the
predicted bank erosion distance for the time step (erosion), the volume
of sediment transport that the stream can convey during the timestep
(vb), the critical depth for bank erosion (dc), channel width at the end
of each timestep (wi)

### Output {.unnumbered}

The function outputs a data frame with values for each time step in the
simulation. The variables in the data frame are:

-   time (in hours)
-   discharge (in m$^3$/s)
-   predicted bank erosion for the time step (in m)
-   volume of bedload transported across the entire channel during the
    time step (in m$^3$)
-   the critical depth for the occurrence of bank erosion (a constant
    value, in m)
-   the simulated channel width at the end of each time step (m)

### Examples {.unnumbered}

Here is an example of the function

```{r}
#specify the flood hydrograph
flood_peak <- 60
time2peak <- 6
dt <- 0.25
test_hydrograph <- scs_hydrograph(flood_peak, time2peak, dt)[[2]]

#specify river reach details
river_n <- 0.04
river_d50 <- 0.04
river_d84 <- 2.1 * river_d50
river_w0 <- 25
river_slope <- 0.007
river_H <- 0.5

out_put <- bank_erode_fp(test_hydrograph, dt, river_n, river_d84, river_d50, river_w0, river_slope, river_H)
head(out_put)
```

The total change in width and the total volume of bedload transport can be calculated from the data.
Note that this estimate reflects the decline in transport rate due to
channel widening, resulting in a hysteresis loop in the data.

```{r}
total_width_increase <- sum(out_put$erosion)
print(total_width_increase)

total_transport_volume <- sum(out_put$Vb)
print(total_transport_volume)

plot(out_put$Q, out_put$Vb,
     col = "darkorange",
     pch = 21,
     type = "b",
     xlab = expression(Discharge~(m^3/s)),
     ylab = expression(Transport~volume~(m^3/s)))
                       
```

The volume that would be transported if bank erosion did not occur can
be estimated by putting in a very high bank strength value. However, this analysis
assumes that the channel is rectangular, and does not capture the effects of changing
channel width with flood stage.  If bank erosion can be ignored, it is more appropriate
to use apply the `estimate_capacity()` function above to a real cross section instead
of using functions relying on `gbem()`.

```{r}
#repeat analysis with higher bank strength
river_H <- 5
out_put <- bank_erode_fp(test_hydrograph, dt, river_n, river_d84, river_d50, river_w0, river_slope, river_H)

total_transport_volume <- sum(out_put$Vb)
print(total_transport_volume)

plot(out_put$Q, out_put$Vb,
     col = "darkorange",
     pch = 21,
     type = "b",
     xlab = expression(Discharge~(m^3/s)),
     ylab = expression(Transport~volume~(m^3/s)))
                       

```

### See also {.unnumbered}

`bank_erode_trc()` `gbem()`

------------------------------------------------------------------------

## bank_erode_trc

Estimate the cumulative bank erosion during a flood hydrograph in an
incized channel

### Usage {.unnumbered}

`bank_erode_trc(   Q,   t,   n,   D84,   D50,   W,   S,   H = 0,   Z,   fun = "ec",   g = 9.81,   rho_s = 2650,   rho = 1000 )`

### Arguments {.unnumbered}

-   `Q` a list of discharge values at regular time intervals defining
    the flood hydrograph (m$^3$/s)

-   `t` time interval between discharge measurements (hrs)

-   `n` Manning's n value for the main channel

-   `D84` 84th percentile of the surface grain size distribution (m)

-   `D50` 50th percentile of the grain size distribution (m)

-   `W` water surface width at the beginning of time interval t

-   `S` energy gradient of the stream channel (m/m)

-   `H` effective rooting depth for vegetation grassy banks, no trees /
    shrubs H = 0.35; 1 to 5percent tree / shrub cover H = 0.50; 5 to
    50percent tree / shrub cover H = 0.90; more than 50percent tree /
    shrub cover H = 1.1

-   `Z` height of the terrace above the channel bottom (m)

-   `fun` choice of transport function. Default is Eaton and Church
    ("ec")

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

This function implements the GBEM model for estimating bank erosion
using a simple adjustment parameter to adapt the standard model for
streams where the channel is incised, and confined by a terrace. The
function outputs a data frame containing variables for time since the
start of the hydrograph (time), discharge values for each time (Q), the
predicted bank erosion distance for the time step (erosion), the volume
of sediment transport that the stream can convey during the timestep
(vb), the critical depth for bank erosion (dc), channel width at the end
of each timestep (wi)

### Output {.unnumbered}

The function outputs a data frame with values for each time step in the
simulation. The variables in the data frame are:

-   time (in hours)
-   discharge (in m$^3$/s)
-   predicted bank erosion for the time step (in m)
-   volume of bedload transported across the entire channel during the
    time step (in m$^3$)
-   the critical depth for the occurrence of bank erosion (a constant
    value, in m)
-   the simulated channel width at the end of each time step (m)

### Examples {.unnumbered}

Here is an example of the function.

```{r}
#use the flood hydrograph created above for bank_erode_fp


#use the same river reach details as for bank_erode_fp
river_H <- 0.5
river_Z <- 2.5

out_put <- bank_erode_trc(test_hydrograph, dt, river_n, river_d84, river_d50, river_w0, river_slope, river_H, river_Z)
head(out_put)
```

The total change in width and the total volume of bedload transport can be calculated from the data.
Note that this estimate reflects the decline in transport rate due to
channel widening, resulting in a hysteresis loop in the data.

```{r}
total_width_increase <- sum(out_put$erosion)
print(total_width_increase)

total_transport_volume <- sum(out_put$Vb)
print(total_transport_volume)

plot(out_put$Q, out_put$Vb,
     col = "darkorange",
     pch = 21,
     type = "b",
     xlab = expression(Discharge~(m^3/s)),
     ylab = expression(Transport~volume~(m^3/s)))
                       
```

Compared to the same analysis using `bank_erode_fp()` the amount of widening is lower and the total transport volume is higher, reflecting the fact that this stream is confined by a terrace.


### See also {.unnumbered}

`bank_erode_fp()`, `gbem()`

------------------------------------------------------------------------

## step_length

Calculating the step length for sediment transport of coarse bed
material

### Usage {.unnumbered}

`step_length(   D50,   q,   d,   S,   dt,   flashy = FALSE,   use_ferguson = TRUE,   g = 9.81,   rho = 1000 )`

### Arguments {.unnumbered}

-   `D50` median bed sediment grain diameter (m)

-   `q` a list of specific discharge values for a hydrograph (m3/s/m)

-   `d` flow depth at the bankfull stage (m)

-   `S` gradient of the water surface slope (m/m)

-   `dt` time interval between discharge measurements (hrs)

-   `flashy` a logical variable (true if the hydrograph is short and
    flashy)

-   `use_ferguson` logical variable for selecting the ferguson equation
    for calculating the critical stream power}

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

this function calculates the average distance for bedload transport
during a flow of a given duration. This is a good tool for estimating potential
relations between sediment sources and sediment deposition areas.  It addresses
only the coarse sediment that moves along the channel bed, not the silt, sand
and finer granules that can move in saltation of suspension modes. 

### Output {.unnumbered}

### Examples {.unnumbered}

Here is an example of the function in use for Fishtrap Creek, where tracers were deployed in 2006.

```{r}
#simulate the hydrograph
Q <- scs_hydrograph(Qpeak = 7, 
                    tpeak = 8, 
                    dt = 1)[[2]]
q <- Q / 6  #channel is approximately 6 m wide
d <- 0.6  #estimated bankfull depth
D50 <- 0.05
Slope <- 0.02

#use same values for stream evaluated in bank_erode_pf() and bank_erode_trc()
step_length(D50, q, d, Slope, 1, flashy = FALSE, use_ferguson = TRUE)
```

Typically, step length during a bankfull flow is on the order of 5 to 10 times the channel width, depending on the flood duration, which in this case lines up with the estimate assuming that the flood was not particularly flashing and using the Ferguson (2005) to estimate the critical stream power for entrainment. 

The estimation of step length is very sensitive to the quality of the input data, particularly the estimate of the specific discharge value.  If little is known about the hydrograph shape, it is appropriate to assume the flood is flashy, in which case a function using only the peak specific discharge is used. 

### See also {.unnumbered}

`crit_power()`, `unit_power()`

------------------------------------------------------------------------

## quick_ffa_ann

This function uses the `RivRetrieve` package to source and download all
available daily discharge measurements for any Water Survey of Canada of
USGS gauging station, identify the maximum flows, and perform a flood
frequency analysis using maximum likelihood estimation to fit a
Generalized Extreme Value distribution to the data.

### Usage {.unnumbered}

`quick_ffa_ann(station, rp, qual)`

### Arguments {.unnumbered}

`station` a string containing the station name (e.g. '08GA022' or
'14048000')

`rp` a vector containing the return periods for which to estimate flood
quantiles. Default values are 2, 5, 10, 20, 50, 100, and 200 yrss

`qual` a value from 0 to 1 specifying how complete an annual dataset
should be in order to estimate an annual maximum discharge value for
that year. Default value is 0.6.

### Details {.unnumbered}

When applying this function for the first time to data from the Water Survey
of Canada, you will need to first run `tidyhydat::download_hydat()` to download
the hydat database on your computer. Data from the USGS is provided from an
online repository and no additional installation in necessary.

### Output {.unnumbered}

The function produces a graph showing the data and the fitted GEV model,
and outputs a data frame containing flood quantiles for the specified
return periods.

### Examples {.unnumbered}

The following example shows the function applied to a USGS station and a
WSC station.

```{r}
# if running for the first time, also run...
# tidyhydat::download_hydat()

wsc_test <- quick_ffa_ann('08GA022')

print(wsc_test)

usgs_test <-quick_ffa_ann('12150800')

print(usgs_test)
```

### See also {.unnumbered}

`quick_ffa_dual()`

------------------------------------------------------------------------

## quick_ffa_dual

Estimate flood quantiles for dual mechanism daily maximum flows

### Usage {.unnumbered}

`quick_ffa_dual(   station,   start = "04-01",   end = "07-01",   rp = c(2, 5, 10, 20, 50, 100, 200),   qual = 0.6 )`

### Arguments {.unnumbered}

-   `station` a string containing the station name (e.g. '08GA022' or
    '14048000')

-   `start` a string specifying the beginning of the melt window in
    MM-DD format

-   `rp` a vector containing the return periods for which to estimate
    flood quantiles

-   `qual` a value from 0 to 1 specifying how complete an annual dataset
    should be in order to estimate an annual maximum discharge value for
    that year

### Details {.unnumbered}

This function loads data from WSC or USGS stations and fits a
generalized extreme value (GEV) distribution to the data using maximum
likelihood estimation.

### Output {.unnumbered}

The function produces a graph showing the data and the fitted GEV model,
and outputs a data frame containing flood quantiles for the specified
return periods.

### Examples {.unnumbered}

```{r}
# if running for the first time, also run...
# tidyhydat::download_hydat()

wsc_test <- quick_ffa_dual('08MF065',
                           start = '04-01',
                           end = '07-01')

print(wsc_test)

usgs_test <-quick_ffa_dual('12451000',
                           start = '04-01',
                           end = '07-01')

print(usgs_test)
```

### See also {.unnumbered}

`quick_ffa_ann()`


## max_min_timing

***

## flow_regime


***

# Hydraulics Functions

------------------------------------------------------------------------

## u_ferg

Estimating the mean flow velocity using the Ferguson 2007 equation.

### Usage {.unnumbered}

`u_ferg(R, S, d84, a1 = 6.5, a2 = 2.5, g = 9.81)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d84` 84th percentile diameter of bed sediment (m)

-   `a1` constant fit by Ferguson (2007). Defaults to 6.5

-   `a2` constant fit by Ferguson (2007). Defaults to 2.5

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

### Details {.unnumbered}

This function uses the Ferguson (2007) flow resistance law to estimate
the mean velocity of the flow using the bed surface D84

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## tau_1D

Calculating the cross section average shear stress

### Usage {.unnumbered}

`tau_1D(R, S, g = 9.81, rho = 1000)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

this function calculates the average shear stress acting on the channel
boundary for a given cross section.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## t_star

Estimating the dimensionless shear stress

### Usage {.unnumbered}

`t_star(tau, d, g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `tau` the cross section-averaged shear stress (Pa/m$^2$)

-   `d` median bed sediment grain diameter (m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function calculates the dimensionless shear stress using the bed
surface median grain size.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## unit_power

Calculating the cross section average unit stream power

### Usage {.unnumbered}

`unit_power(q, S, g = 9.81, rho = 1000)`

### Arguments {.unnumbered}

-   `q` specific discharge (m$^3$/s/m)

-   `S` gradient of the water surface slope (m/m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

this function calculates the unit stream power acting on the channel
boundary for a given cross section.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

# Sediment Transport Functions

------------------------------------------------------------------------

## mpm

Estimating bedload transport using Meyer Peter and Muller

### Usage {.unnumbered}

`mpm(R, S, d, t_crit = 0.047, g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `t_crit` critical dimensionless shear stress. Defaults to 0.047

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function uses a dimensionless form of the traditional Meyer Peter
and Muller equation to estimate the dimensionless bedload flux for a
given shear stress and characteristic grain size.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## wp

Estimating bedload transport using Wong and Parker (2006)

### Usage {.unnumbered}

`wp(R, S, d, t_crit = 0.047, g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `t_crit` critical dimensionless shear stress. Defaults to 0.047

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function uses a dimensionless form of a modified version of Meyer
Peter and Muller equation to estimate the dimensionless bedload flux for
a given shear stress and characteristic grain size. Using the original
Meyer Peter and Muller equation will produce higher transport estimates
and is more conservative than using this modified version.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## eb

Estimating bedload transport using Einstein and brown (1950)

### Usage {.unnumbered}

`eb(R, S, d, g = 9.81, rho = 1000, rho_s = 2650, kv = 1e-06)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

This function uses a dimensionless form of Einstein and brown (1950)
bedload transport function for use with sand bed rivers and gravel bed
rivers.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## yln

Estimating bedload transport using Yalin (1963)

### Usage {.unnumbered}

`yln(   R,   S,   d,   t_crit = t_crit_soul(d),   g = 9.81,   rho = 1000,   rho_s = 2650,   kv = 1e-06 )`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `t_crit` critical dimensionless shear stress, calculated using
    Soulsby (1997)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

This function uses a dimensionless form of Yalin's (1963) bedload
transport function for use with sand bed rivers and gravel bed rivers.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## vr

Estimating bedload transport using Van Rijn (1984)

### Usage {.unnumbered}

`vr(   R,   S,   d,   t_crit = t_crit_vr(d, rho, rho_s, g, kv),   g = 9.81,   rho = 1000,   rho_s = 2650,   kv = 1e-06 )`
\### Arguments {-}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `t_crit` critical dimensionless shear stress

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

This function uses a dimensionless form of Van Rijn's (1984) bedload
transport function for use with sand bed rivers.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## wc

Estimating fractional bedload transport using Wilcock and Crowe (2003)
in m3/second

### Usage {.unnumbered}

`wc(R, S, gsd, Fsand, g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `gsd` a data frame describing the grain size distribution created
    with function wolman_gsd()

-   `Fsand` proportion of the surface that is covered by sand sized
    sediment (affects entrainment, typically varies from 0 to 0.2)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `counts` number of stones in each size class size class bounds
    (!!!must start with a 0!!!)

### Details {.unnumbered}

This function uses the Wilcock and Crowe transport function on standard
data from a surface Wolman count to estimate the fraction-specific
transport rate for a given shear stress. Output is a data frame
containing inputted GSD information for each size class (Di, cpf, Dm,
Fi), as well as the dimensionless transport rate (Wi), the volumetric
transport rate per unit width (qbi), and the fraction of the computed
bedload in each size class (Li)

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## ec

Estimating bed material transport using Eaton and Church (2011)

### Usage {.unnumbered}

`ec(   R,   S,   d,   d84 = 2 * d,   g = 9.81,   rho = 1000,   rho_s = 2650,   U = u_ferg(R, S, d84, a1, a2, g),   a1 = 6.5,   a2 = 2.5,   kv = 1e-06,   t_crit = t_crit_soul(d, rho, rho_s, g, kv) )`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `d84` 84th percentile diameter of bed sediment (m). Defaults to 2 \*
    d

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `U` mean flow velocity. Defaults to flows calculated using Ferguson

    (2007) 

-   `a1` constant fit by Ferguson (2007). Defaults to 6.5

-   `a2` constant fit by Ferguson (2007). Defaults to 2.5

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

-   `t_crit` critical dimensionless shear stress, calculated using
    Soulsby (1997)

### Details {.unnumbered}

This function uses a dimensionless stream power equation from Eaton and
Church (2011) to estimate bed material load transport in sand bed rivers
and gravel bed rivers.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## rk

Estimating bed material transport using Recking (2013)

### Usage {.unnumbered}

`rk(R, S, d, d84 = 2 * d, g = 9.81, rho = 1000, rho_s = 2650, rp = FALSE)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `d` median bed sediment grain diameter (m)

-   `d84` 84th percentile diameter of bed sediment (m). Defaults to 2 \*
    d

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `rp` option to select equation suited to riffle pool morphology,
    default is FALSE

### Details {.unnumbered}

This function uses a dimensionless shear stress equation from Recking
based on the D84 of the bed surface, and is the version for use with
field data.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

# Bed Entrainment Functions

------------------------------------------------------------------------

## qb_conversion

Converting dimensionless bedload flux to volumetric flux

### Usage {.unnumbered}

`qb_conversion(q_star, d, g = 9.81, Gs = 1.65)`

### Arguments {.unnumbered}

-   `q_star` dimensionless bedload flux}

-   `d` median bed sediment grain diameter (m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `Gs` the submerged specific gravity of sediment. Defaults to 1.65

### Details {.unnumbered}

this function converts dimensionless bedload transport flux values to
fluxes in cubic meters per second per meter

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## t_crit_soul

Estimating critical dimensionless shear stress

### Usage {.unnumbered}

`t_crit_soul(d, rho = 1000, rho_s = 2650, g = 9.81, kv = 1e-06)`

### Arguments {.unnumbered}

-   `d` median bed sediment grain diameter (m)

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

Using the equation published by Soulsby (1997), this function estimates
the critical dimensionless shear stress as a function of grain size.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## t_crit_vr

Estimating critical dimensionless shear stress

### Usage {.unnumbered}

`t_crit_vr(d, rho = 1000, rho_s = 2650, g = 9.81, kv = 1e-06)`

### Arguments {.unnumbered}

-   `d` median bed sediment grain diameter (m)

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

Using the equation published by Van Rijn (1984), this function estimates
the critical dimensionless shear stress as a function of grain size.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## t_ref_star

Estimating reference dimensionless shear stress for Wilcock & Crowe
(2003)

### Usage {.unnumbered}

`t_ref_star(Fsand)`

### Arguments {.unnumbered}

-   `Fsand` Proportion of sand on the bed surface

### Details {.unnumbered}

Using the equation published by Wilcock & Crow, this function estimates
the reference dimensionless shear stress based on the fraction of sand
on the bed.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## crit_power

Estimating critical stream power for bed entrainment

### Usage {.unnumbered}

`crit_power(D50, d, use_ferguson = TRUE)`

### Arguments {.unnumbered}

-   `D50` median bed sediment grain diameter (mm)

-   `d` flow depth (m)

### Details {.unnumbered}

Using the equation published by Ferguson (2005) or Petit et al. (2005),
this function estimates the critical stream power as a function of grain
size, and flow depth. These empirical equations are valid for D50
ranging from 20 to 150 mm

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

# Data Import / Analysis / Simulation Functions

## scs_hydrography

Creating a hydrograph based on the Standard SCS Dimensionless Unit
Hydrograph

### Usage {.unnumbered}

`scs_hydrograph(Qpeak, tpeak, dt)`

### Arguments {.unnumbered}

-   `Qpeak` the peak instantaneous discharge to be reached during the
    hydrograph (cumecs)

-   `tpeak` the lag time between the peak rainfall input and the peak
    runoff (hours)

-   `dt` a parameter that controls the time increment for data output
    (in hours)

### Details {.unnumbered}

This function uses the Soil Conservation Service Standard Unit
Hydrograph to simulate a simple hydrograph associated with a rainfall
event. The hydrograph depends on a parameter controlling the peak flow
that will be reached and a parameter controlling how quickly the
hydrograph will rise and fall. The shape of the hydrograph remains the
same.

The dimensionless unit hydrograph used by the SCS was developed by
Victor Mockus and was derived based on a large number of unit
hydrographs from basins that varied in characteristics such as size and
geographic location. The unit hydrographs were averaged and the final
product was made dimensionless by considering the ratios of Q/Qpeak
(flow/peak flow) on the ordinate axis and t/tpeak (time/time to peak) on
the abscissa. This final, dimensionless unit hydrograph, which is the
result of averaging a large number of individual dimensionless unit
hydrographs, has a time-to-peak located at approximately 20 percent of
its time base and an inflection point at 1.7 times the time-to-peak.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## wolman_gsd

Processing Wolman count data into grain size distribution

### Usage {.unnumbered}

`wolman_gsd(Di, counts)`

### Arguments {.unnumbered}

-   `Di` a list of grain sizes representing the upper bounds of the size
    classes

-   `counts` the number of stones sampled in the szie class defined by
    the upper bound values, Di

This function uses standard data from a surface Wolman count to estimate
cumulative percent finer for each size, the fraction of the distribution
in a given size class, and the median size of each size class. Output is
a data frame containing the upper limit of each size class (Di), the
cumulative proportion finer than the size listed in Di (cpf), the median
size for each size class (Dm), and the fraction of the distribution in
each class (Fi)

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## make_trapezoid

Create a cross section based on measured trapezoid dimensions

### Usage {.unnumbered}

`make_trapezoid(w_top, w_bot, H_bank, Z_fp, dx = 0.1)`

### Arguments {.unnumbered}

-   `w_top` measured or estimated top width of the trapezoid (m)

-   `w_bot` measured or estimated bottom width of the trapezoid (m)

-   `H_bank` measures or estimated vertical height of the trapezoid (m)

-   `dx` a parameter controlling the spacing between exported data
    points on the section

-   `z_fp` elevation of the top of the trapezoid (i.e. the floodplain or
    terrace elevation, m)

### Details {.unnumbered}

This function creates profile data including the distance along the
profile from the left bank.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

------------------------------------------------------------------------

## load_section

Load cross section data

### Usage {.unnumbered}

`load_section(xs_nm, dx = NA, rev = FALSE, trim = FALSE, mkplt = FALSE)`

### Arguments {.unnumbered}

-   `xs_nm` path to a csv file with 3 columns containing the profile
    data

-   `dx` optional dist. increment to resample section at regular
    intervals (m)

-   `rev` option to reverse the direction in which distance is measured

-   `trim` option to identify left & right banks and trim section

-   `mkplt` option to make a plot of the data (original &
    resampled/trimed)

### Details {.unnumbered}

This function loads profile data that is saved in a text file (XYZ
format) and calculates the distance along the profile from the first
data point in the file. The function assumes that the first row is
header information, and that the data in column 1 correspond to x
coordinates (or eastings), column 2 corresponds to y coordinates
(northings), and column 3 corresponds to elevation.

### Output {.unnumbered}

### Examples {.unnumbered}

### See also {.unnumbered}

# Utility Functions

## find_q_b

Calculating volumetric unit transport rate for a specified function

### Usage {.unnumbered}

`find_q_b(R, S, D50, D84, fun = "ec", g = 9.81, rho = 1000, rho_s = 2650)`

### Arguments {.unnumbered}

-   `R` hydraulic radius for the flow (m)

-   `S` gradient of the water surface slope (m/m)

-   `D50` 50th percentile of the grain size distribution (m)

-   `D84` 84th percentile of the surface grain size distribution (m)

-   `fun` choice of transport function. Default is Eaton and Church
    ("ec")

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

-   `rho_s` sediment density. Defaults to 2650 kg/m$^3$

### Details {.unnumbered}

This function takes the hydraulic data required to calculate the
dimensionless shear stress and uses a specified bedload transport
function to calculate the volumetric transport rate per unit width.

------------------------------------------------------------------------

## find_d_crit

find the critical depth at which bank erosion will begin

### Usage {.unnumbered}

`find_d_crit(Q, H, t_c84, S, g = 9.81, rho = 1000, tol = 0.001)`

### Arguments {.unnumbered}

-   `Q` a list of discharge values at regular time intervals defining
    the flood hydrograph (m$^3$/s)

-   `H` effective rooting depth for vegetation

-   `t_c84` stress required to entrain the 84th percentile of the bed
    surface

-   `S` energy gradient of the stream channel (m/m)

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `rho` fluid density. Defaults to 1000 kg/m$^3$

### Details {.unnumbered}

this is a utility function used by GBEM to determine the typical
floodplain thickness above the channel bed. \*\*\*

## est_mu

estimate relative bank strength

### Usage {.unnumbered}

`est_mu(H, d)`

### Arguments {.unnumbered}

-   `H` effective rooting depth for vegetation}

-   `d` channel depths}

### Details {.unnumbered}

this is a utility function used by GBEM to determine the relative bank
strength given the channel depth and rooting depth. It returns a
variable that is the bank strength relative to the bed strengths.

------------------------------------------------------------------------

## d_star

Estimating dimensionless particle size

### Usage {.unnumbered}

`d_star(d, Gs = 1.65, g = 9.81, kv = 1e-06)`

### Arguments {.unnumbered}

-   `d` median bed sediment grain diameter (m)

-   `Gs` the submerged specific gravity of sediment. Defaults to 1.65

-   `g` the acceleration of gravity. defaults to 9.81 m/s$^2$

-   `kv` kinematic viscosity of water. Defaults to 1e$^-6$

### Details {.unnumbered}

this function estimates the dimensionless particle size

------------------------------------------------------------------------

## calc_depths

### Usage {.unnumbered}

`calc_depths(xs_data, wse, mkplt = F)`

### Arguments {.unnumbered}

-   `xs_data` a data frame containing \$dist (distances) and \$z
    (elevations)

-   `wse` elevation of the water surface of interest (m)

-   `mkplt` logical option to plot the data, default is FALSE}

### Details {.unnumbered}

this function uses a water surface elevation (WSE) and the location
index for the channel thalweg to calculate the depths in the main
channel. disconnected areas outside the main channel that are below the
WSE are located and assigned a depth of NA. This is particularly
important on a fan
